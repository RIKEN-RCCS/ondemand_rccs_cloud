<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>R-CCSクラウド利用マニュアル</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex,nofollow">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>

  <div class="container-fluid">
    <nav class="sidebar bg-body-secondary">
      <h5 class="ps-3 pe-1 d-inline">目次</h5><a href="ood.html" style="font-size: 0.75rem;" class="text-decoration-none ms-0">[English]</a>
      <ul class="nav flex-column px-3 py-2">
        <li class="nav-item"><a href="index_ja.html" class="nav-link">1. はじめに</a></li>
        <li class="nav-item"><a href="resource_ja.html" class="nav-link">2. 計算資源</a></li>
        <li class="nav-item"><a href="storage_ja.html" class="nav-link">3. ストレージ</a></li>
        <li class="nav-item"><a href="ood_ja.html" class="nav-link">4. Open OnDemand</a></li>
        <li class="nav-item"><a href="terminal_ja.html" class="nav-link">5. ターミナル</a></li>
        <li class="nav-item"><a href="other_ja.html" class="nav-link">6. その他</a></li>
      </ul>
    </nav>

    <main class="main-content">
      <h2>4. Open OnDemand</h2>
      <img width="600" alt="Open OnDemand" src="img/ood.png">
      <p>
        上図はR-CCSクラウドのOpen OnDemandのダッシュボードです。R-CCSクラウドのロゴの右側にある表は、各パーティションにおける利用可能なノード数を示しています。ロゴの上側にあるメニューバーの意味は下記の通りです（ブラウザの幅が狭くなると、アイコン表示に変わるものもあります）。
      </p>
      <table class="table">
        <tr><th>項目</th><th>意味</th></tr>
        <tr><td>Interactive Apps</td><td>計算ノードで動作する対話アプリケーション</td></tr>
        <tr><td>Passenger Apps</td><td>Open OnDemandサーバで動作するアプリケーション</td></tr>
        <tr><td>My Interactive Sessions</td><td>対話アプリケーションのセッション情報の一覧</td></tr>
        <tr><td>Help &rarr; Restart Web Server</td><td>Open OnDemandを再起動する</td></tr>
        <tr><td>Help &rarr; Manual</td><td>本マニュアルへのリンク</td></tr>
        <tr><td>Log Out</td><td>ログアウトする</td></tr>
      </table>

      <h3>4.1. 対話アプリケーション</h3>
      <p>
        対話アプリケーションとは、計算ノード上で実行されるアプリケーションをユーザが対話的に操作できるアプリケーションです。
      </p>
      <p>
        例として、リモートデスクトップの利用方法を説明します。アイコンの「Desktop」をクリックすると、計算リソースなどを入力するためのWebフォームが表示されます。入力後に「Launch」をクリックすると、R-CCSクラウドにジョブが投入されます。
      </p>
      <img width="400" alt="Webform of Remote Desktop" src="img/remote_desktop_webform.png">
      <p>
        ジョブ投入直後は、右上に「Queued」と記述された画面が表示されます。これは、ジョブは実行待ちであることを表しています。ジョブが計算ノードで起動すると「Running」という表示に変わり、「Launch Desktop」というボタンが表示されます。「Commpression（圧縮レベル）と「Image Quality（画質レベル）」に適当な値を設定して、「Launch Desktop」のボタンをクリックすると、リモートデスクトップがWebブラウザに表示されます。
      </p>
      <p>「View Only (Share-able Link) 」ボタンをクリックすると、ミラーリングされたリモートデスクトップが新しいタブで開きます。ミラーリングされた画面は操作できません。このタブのURLをメール等で送信することで、画面共有を行うことができます（R-CCSクラウドにアカウントを持っているユーザ間でのみ画面共有が可能です）。
      </p>
      <img width="600" alt="Running Status" src="img/remote_desktop_running.png"><p></p>
      <img width="600" alt="Remote Desktop" src="img/remote_desktop.png">
      <p>リモートデスクトップを終了させたい場合は、下記の手順のどれかを行ってください。Webブラウザを閉じるだけでは終了されないことに注意してください。</p>
      <ul>
        <li>2つ前の画像の「Delete」ボタンをクリックする。</li>
        <li>メニューバーの「My Interactive Sessions」をクリックし、該当のジョブの「Delete」ボタンをクリックする。</li>
        <li>リモートデスクトップの左上の「Applications」から「Log Out」をクリックする。</li>
      </ul>

      <h3>4.2. バッチジョブ</h3>
      <p>
        バッチジョブとは、ジョブスケジューラによって非対話的に実行される計算タスクのことです。バッチジョブはシェルスクリプトで記述され、必要な計算資源（たとえばノード数や最大実行時間など）は、ジョブスケジューラのディレクティブ（例：<code>#SBATCH -N 4</code>）を用いて指定します。R-CCSクラウドOpen OnDemandでは、Open OnDemand上で動作するアプリケーションである<a target="_blank" href="https://github.com/RIKEN-RCCS/OpenComposer/">Open Composer</a>を利用しており、簡易にバッチジョブの投入と管理を行うことができます。
      </p>
      <p>
        Slurmのアイコンをクリックください。ジョブスクリプトを生成するためのWebフォームが表示されます。右上の「Script Location」はジョブスクリプトの保存場所、「Script Name」はジョブスクリプトのファイル名、「Job Name」はジョブの名前（省略可能）を指定します。左下はジョブに関する入力項目であり、入力すると右下のジョブスクリプトが自動更新されます。入力後に「Submit」をクリックすると、R-CCSクラウドにジョブが投入されます。
      </p>
      <img width="600" alt="Slurm" src="img/slurm.png">
      <p>
      ジョブが正常に投入されると上の方に表示される「History page」へのリンクをクリックします。
      </p>
      <img width="400" alt="Link to Histroy Page" src="img/link_to_history.png">
      <p>
      History pageでは、これまでに投入したジョブの履歴を閲覧することができます。表の各行は1つのジョブの情報を示しています。左上にある「Cancel Job」と「Delete Info」のボタンは、それぞれ「実行中のジョブのキャンセル」と「表からジョブの情報を削除する」ことを行います。それらの動作を行うためには、表の左端の列にある対応するチェックボックスをオンにします。
      </p>
      <p>
      右上にあるテキストエリアとラジオボタンは、表に表示されるジョブをフィルタリングするために使用します。「Filter」に文字列を入力すると、その文字列に関係するジョブだけが表示されます。「All」、「Running」、「Queued」、「Completed」のラジオボタンはジョブの状態を表しており、その状態のジョブだけが表示されます。
      </p>
      <img width="600" alt="Histroy Page" src="img/history.png">
      <p>
      「Job ID」列のリンクをクリックすると、ジョブスケジューラから取得されたプロファイリング情報が表示されます。
      </p>
      <img width="400" alt="Job ID in Histroy Page" src="img/history_jobid.png">
      <p>
     「Application」列のリンクをクリックすると、そのアプリケーションページが開きます。
      <p>
      「Script Location」列のリンクをクリックすると、Open OnDemandの<a href="#file">Home Directory</a>が起動します。また、その横のターミナルアイコンをクリックすると、Open OnDemandの<a href="#shell">Terminal for Login Node</a>が起動します。
      </p>
      <p>
      「Script Name」列のリンクをクリックすると、送信されたシェルスクリプトの内容を表示するウィンドウが開きます。そのウィンドウの「Load Parameters」ボタンをクリックすると、パラメータが読み込まれたアプリケーションのページが開きます。
      </p>
      <img width="400" alt="Load Parameters" src="img/history_load_parameters.png">

      <h3 id="file">4.3. ファイル操作</h3>
      <p>Home Directoryのアイコンをクリックしてください。ファイルの送受信・編集などを行えます。送受信可能な最大サイズは10GBです。</p>
      <img width="600" alt="Home Directory" src="img/home_directory.png">
      <p>Home Directoryの各機能は下記の通りです。個別のファイルやディレクトリに対する操作は「3点＋下三角」のメニューから行えます。</p>
      <table class="table">
        <tr><th>ツールバー</th><th>説明</th></tr>
        <tr><td>Open in Terminal</td><td>ターミナルの起動</td></tr>
        <tr><td>Refresh</td><td>ページを再描画</td></tr>
        <tr><td>New File</td><td>新規ファイル作成</td></tr>
        <tr><td>New Directory</td><td>新規ディレクトリ作成</td></tr>
        <tr><td>Upload</td><td>ファイルのアップロード</td></tr>
        <tr><td>Download</td><td>ファイルのダウンロード</td></tr>
        <tr><td>Copy/Move</td><td>ファイルのコピー、移動</td></tr>
        <tr><td>Delete</td><td>ディレクトリやファイルの削除</td></tr>
      </table>

      <table class="table">
        <tr><th>パスバー</th><th>説明</th></tr>
        <tr><td>&uarr;</td><td>1つ上のディレクトリに移動</td></tr>
        <tr><td>Change directry</td><td>ディレクトリの移動</td></tr>
        <tr><td>Copy path</td><td>現在のパスをクリップボードにコピー</td></tr>
      </table>

      <table class="table">
        <tr><th>表示オプション</th><th>説明</th></tr>
        <tr><td>Show Owner/Mode</td><td>所有者とパーミッションの表示</td></tr>
        <tr><td>Show Dotfiles</td><td>ドットファイル（隠しファイル）の表示</td></tr>
        <tr><td>Filter</td><td>ファイル名による絞り込み</td></tr>
      </table>

      <p>メニューバーの「Passenger Apps」にあるパスをクリックすると、そのパスを起点としたHome Directoryが起動します。</p>
      <img width="200" alt="Click to Home Directory" src="img/home_directory_click.png">
      <p>
      <a target="_blank" href="https://rclone.org">Rclone</a>を用いたクラウドストレージに対するファイルの操作も可能です。Rcloneの設定を行うには、リモートデスクトップを起動し、そのターミナルから<code>rclone</code>もしくは<code>rclone-browser</code>を実行します。設定後にOpen OnDemandのメニューバーの「Help」&rarr; 「Restart Web Server」をクリックし、Home Directoryを起動すると、設定されたクラウドストレージにアクセスできます。なお、R-CCSクラウドヘルプデスクではRcloneの設定のサポートは行っておりませんのでご了承ください。
      </p>

      <!--
      <h3>3.4. HPCI共用ストレージ（準備中）</h3>
      <p>HPCI Shared Strageのアイコンをクリックください。<a href="https://www.hpci-office.jp">HPCI（High Performance Computing Infrastructure）</a>が提供するHPCI共用ストレージに対するファイル操作を行えます。本アプリケーションを利用するためには、<a href="https://elpis.hpci.nii.ac.jp/">JWT-SERVER</a>からパスフレーズを事前に発行しておく必要があります。</p>
      <img width="600" alt="HPCI Shared Storage" src="img/hpci.png">
      <p>「HPCI ID」にはJWT-SERVERでパスフレーズを生成したときに表示される<code>hpcixxxxxx</code>という文字列（<code>xxxxxx</code>は数字）を、「Passphrase」には生成されたパスフレーズを入力した後、「mount」ボタンをクリックください。</p>

      <h3>3.5. GakuNin RDM（準備中）</h3>
      <p>GakuNin RDMのアイコンをクリックください。国立情報学研究所が提供する研究データ管理基盤である<a target="_blank" href="https://rdm.nii.ac.jp">GakuNin RDM</a>に対するファイル操作を行えます。本アプリケーションを利用するためには、GakuNin RDMのプロジェクトを事前に作成しておく必要があります。</p>
      <img width="600" alt="GakuNin RDM" src="img/grdm.png">
      <p>「Mount Path」にはR-CCSクラウド側のファイルシステムのマウントパス（例：<code>/home/rccs-aot/a00000/abc</code>）を、「RDM Node ID」はGakuNin RDMのプロジェクトのURL（<code>https://rdm.nii.ac.jp/xxx/</code>）の<code>xxx</code>の箇所を、「ROM Token」はGakuNin RDMのパーソナルアクセストークンを入力した後、「mount」ボタンをクリックください。</p>
     -->
      <h3 id="shell">4.4. ターミナル</h3>
      <p>Terminal for Login Nodeのアイコンをクリックください。WebブラウザからログインノードにSSHアクセスし、コマンドラインインタフェースを用いた操作を行うことができます。</p>
      <img width="600" alt="Terminal for Login Node" src="img/shell_access.png">

      <h3>4.5. ジョブのモニタリング</h3>
      <p>Active Jobsのアイコンをクリックください。ジョブの情報を閲覧や削除を行うことができます。「ID」の列の左側のボタンをクリックすると、ジョブ詳細情報を表示できます。「Actions」の列のボタンをクリックすると、ジョブの削除を行えます。</p>
      <img width="600" alt="Active Jobs" src="img/activejobs.png">

      <h3>4.6. クラスタの利用状況</h3>
      <p>System Statusのアイコンをクリックください。各パーティションの利用状況を閲覧できます。</p>
      <img width="600" alt="Grafana" src="img/grafana.png">

      <h3>4.7. SSH公開鍵の登録</h3>
      <p>SSH Public Keyのアイコンをクリックください。詳細は、<a href="index_ja.html#ssh">1.2. ターミナルソフトウェアの利用</a>を参照ください。</p>
    </main>
  </div>

  <footer class="bg-purple d-flex justify-content-center align-items-center">
    <p class="mb-0 text-white">&copy; RIKEN Center for Computational Science</p>
  </footer>
</body>
</html>
