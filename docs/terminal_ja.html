<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>R-CCSクラウド利用マニュアル</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex,nofollow">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>

  <div class="container-fluid">
    <nav class="sidebar bg-body-secondary">
      <h5 class="ps-3 pe-1 d-inline">目次</h5><a href="terminal.html" style="font-size: 0.75rem;" class="text-decoration-none ms-0">[English]</a>
      <ul class="nav flex-column px-3 py-2">
        <li class="nav-item"><a href="index_ja.html" class="nav-link">1. はじめに</a></li>
        <li class="nav-item"><a href="resource_ja.html" class="nav-link">2. 計算資源</a></li>
        <li class="nav-item"><a href="ood_ja.html" class="nav-link">3. Open OnDemand</a></li>
        <li class="nav-item"><a href="terminal_ja.html" class="nav-link">4. ターミナル</a></li>
        <li class="nav-item"><a href="storage_ja.html" class="nav-link">5. ストレージ</a></li>
        <li class="nav-item"><a href="other_ja.html" class="nav-link">6. その他</a></li>
      </ul>
    </nav>

    <main class="main-content">
      <h2>4. ターミナル</h2>
      <p>本章では、ターミナルソフトウェアを用いたコマンドラインによるバッチジョブの投入方法について説明します。R-CCSクラウドではジョブスケジューラにSlurmを用いています。Slurmの利用方法の詳細は<a href="https://slurm.schedmd.com">https://slurm.schedmd.com</a>を参照ください。</p>

      <h3>4.1. バッチジョブの利用</h3>
      <p>例として、以下のジョブスクリプトを<code>sample.sh</code>という名前で保存します。<code>-p</code>で指定する利用可能なパーティションは<a href="resource_ja.html">2. 計算資源</a>を参照してください。
      <div class="card shadow-sm ms-3">
        <div class="card-body p-0">
          <pre class="m-0 p-2 bg-light text-dark">
#!/bin/bash
#SBATCH --job-name=jobname # ジョブ名
#SBATCH -p fx700 # パーティション名
#SBATCH -N 1 # ノード数
#SBATCH -t 01:00:00 # 時間

module load system/fx700 FJSVstclanga
hostname # 実行したいコマンド</pre>
        </div>
      </div>
      <p>
      <code>sbatch</code>コマンドを用いて<code>sample.sh</code>をジョブスケジューラに登録します。指定したパーティションに空きができると、自動的にジョブが実行されます。
      <div class="card shadow-sm ms-3">
        <div class="card-body p-0">
          <pre class="m-0 p-2 bg-light text-dark">
$ sbatch ./sample.sh</pre>
        </div>
      </div>

      <h3>4.2. 対話的利用</h3>
      <p>計算ノードをコマンドラインで対話的に利用する場合、以下のように<code>srun</code>コマンドに<code>--pty</code>オプションに利用するシェルを指定して実行します。</p>
      <div class="card shadow-sm ms-3">
        <div class="card-body p-0">
          <pre class="m-0 p-2 bg-light text-dark">
$ srun -N 1 -p fx700 --pty bash</pre>
        </div>
      </div>
     <p>対話的利用を終わらせるには<code>exit</code>コマンドを実行します。</p>
      <div class="card shadow-sm ms-3">
        <div class="card-body p-0">
          <pre class="m-0 p-2 bg-light text-dark">
$ exit</pre>
        </div>
      </div>

     <h3>4.3. 計算資源の確認</h3>
     <p><code>sinfo</code>コマンドを用いると、計算資源の空き状況を確認できます。<code>STATE</code>が<code>idle</code>である<code>NODELIST</code>が空いている計算ノードです。
      <div class="card shadow-sm ms-3">
        <div class="card-body p-0">
          <pre class="m-0 p-2 bg-light text-dark">
$sinfo
PARTITION    AVAIL  TIMELIMIT  NODES  STATE NODELIST
fx700           up 1-00:00:00     31   idle fx[00-30]
a100            up 1-00:00:00      1  alloc a100-0
a100            up 1-00:00:00      1   idle a100-1
mi100           up 1-00:00:00      1   idle mi100
r340            up 1-00:00:00      2   idle r340-[03-04]
genoa           up 1-00:00:00     13  alloc genoa[00-11,13]
genoa           up 1-00:00:00      3   idle genoa[12,14-15]
genoa-m         up 1-00:00:00      1  alloc genoa-m
qc-a100         up 1-00:00:00      1    mix qc-a100-00
qc-a100         up 1-00:00:00      1  alloc qc-a100-01
qc-h100         up 1-00:00:00      1   idle qc-h100-00
qc-gh200        up 1-00:00:00      5  alloc qc-gh200-[00-04]
qc-gh200        up 1-00:00:00      2   idle qc-gh200-[05-06]
qc-gh200-mig    up 1-00:00:00      1   idle qc-gh200-07
qc-mi250        up 1-00:00:00      4   idle qc-mi250-[00-03]
qc-pvc          up 1-00:00:00      1  alloc qc-pvc-01
qc-pvc          up 1-00:00:00      1   idle qc-pvc-00
qc-mi210        up 1-00:00:00      1  alloc qc-mi210-01
qc-mi210        up 1-00:00:00      1   idle qc-mi210-00
ai-h100l-pu     up      30:00      2   idle ai-h100l-[00-01]
ai-h100l        up 1-00:00:00      2   idle ai-h100l-[00-01]
ai-h200-brc     up 1-00:00:00      1   idle ai-h200-brc-00
ai-l40s         up 1-00:00:00      3   idle ai-l40s-[00-02]
fs-mi300a       up 1-00:00:00      1   idle fs-mi300a-00
fs-mi300x       up 1-00:00:00      1   idle fs-mi300x-00</pre>
        </div>
      </div>

     <h3>4.4. ジョブの確認</h3>
     <p><code>squeue</code>コマンドを用いると、ジョブの状況を確認できます。特定のジョブの状況を調べたい場合は、<code>-j</code>オプションでジョブIDを指定します。
      <div class="card shadow-sm ms-3">
        <div class="card-body p-0">
          <pre class="m-0 p-2 bg-light text-dark">
$ squeue -j 77780
JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
77780     fx700  jobname masahiro  R       0:04      2 fx[00-01]</pre>
        </div>
      </div>
    </main>
  </div>
  <footer class="bg-purple d-flex justify-content-center align-items-center">
    <p class="mb-0 text-white">&copy; RIKEN Center for Computational Science</p>
  </footer>
</body>
</html>
